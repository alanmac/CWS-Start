@inherits Umbraco.Web.Mvc.UmbracoTemplatePage
@{
    Layout = null;

    //Set to XML
    Response.ContentType = "text/xml";

    //Homepage node
    var homepage = Umbraco.TypedContentAtRoot().SingleOrDefault();
    
    //Base URL
    var baseUrl = homepage.UrlWithDomain();
    baseUrl     = baseUrl.EndsWith("/") ? baseUrl.TrimEnd("/") : baseUrl;

    //Get child pages of homepage
    var naviPages = homepage.Children.Where(x => x.IsVisible());
    
}<?xml version="1.0" encoding="UTF-8" ?>
<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">
    @ListChildNodes(naviPages, baseUrl)
</urlset>

@helper ListChildNodes(IEnumerable<IPublishedContent> naviItems, string baseUrl)
{
    //For each page in the collection...
    foreach (var item in naviItems)
    {
       <url>
            <loc>@baseUrl@item.Url</loc>
            <lastmod>@item.UpdateDate.ToString("yyyy-MM-dd")</lastmod>
            <changefreq>monthly</changefreq>
            <priority>0.8</priority>
        </url>
        
        @* If the current node in the loop has children *@
        if(item.Children.Any())
        {
            @* Re-run the helper with the children of the current node *@
            @ListChildNodes(item.Children, baseUrl)
        }
    }
}